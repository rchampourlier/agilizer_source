<%
# Build for table:
#   - one row by developer
#   - columns:
#     - developer (header)
#     - one column by sprint
sprint_names = Agilizer::IssueAnalysis::Sprints.names.first(10)
sprint_data = sprint_names.each_with_object({}) do |sprint_name, hash|
  report = Agilizer::IssueAnalysis::Sprints.report(sprint_name)

  report.each do |report_item|
    developer = report_item['developer']
    done = report_item['sprint_start'] - report_item['sprint_end']

    hash[developer] ||= {}
    hash[developer]['developer'] = developer
    hash[developer][sprint_name] ||= 0
    hash[developer][sprint_name] += done
  end
end
%>
<!-- <%= sprint_data %> -->

<%
columns = {
  'developer' => { header: 'Developer', type: :string }
}
sprint_names.each do |sprint_name|
  columns.merge! sprint_name => { header: sprint_name.gsub('Sprint ', ''), type: :time }
end
%>

<% table = { columns: columns, rows: sprint_data.values } %>
<%= erb :'shared/_table', locals: { table: table } %>
