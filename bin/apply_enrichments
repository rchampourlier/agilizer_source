#!/usr/bin/env ruby
#
# Process all `Agilizer::Issue` to fetch code changes
# from Github according to the pull request information
# in the issue.
#
# Uses the `Agilizer::Enrichments::SourceCodeChange` module.
#
# Usage:
#   bin/apply_enrichments

# Load dependencies
require 'rubygems'
require 'bundler/setup'

$LOAD_PATH.unshift File.expand_path('../..', __FILE__)
require 'config/boot'

require 'agilizer'
require 'agilizer/issue'

logger = Logger.new(STDOUT)
logger.level = Logger::DEBUG

require 'agilizer/issue'
require 'agilizer/enrichments/source_code_changes'
require 'agilizer/enrichments/sprints_from_history'

sprints_info = Agilizer::Enrichments::SprintsFromHistory.build_sprints_info

Agilizer::Issue.each do |issue|
  logger.info "Processing issue #{issue.identifier}"
  # Agilizer::Enrichments::SourceCodeChanges.run(issue.identifier)

  Agilizer::Enrichments::SprintsFromHistory.run(
    issue.identifier,
    sprints_info)
end
