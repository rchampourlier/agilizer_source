#!/usr/bin/env ruby
#
# Process all Issue records to fetch code changes
# from Github according to the pull request information
# in the issue.
#
# Uses the `Agilizer::Enrichments::SourceCodeChange` module.
#
# Usage:
#   bin/apply_enrichments

# Load dependencies
require "rubygems"
require "bundler/setup"

$LOAD_PATH.unshift File.expand_path("../..", __FILE__)
require "config/boot"

require "agilizer"
require "agilizer/issue"

logger = Logger.new(STDOUT)
logger.level = Logger::DEBUG

require "agilizer/issue"
require "agilizer/enrichments/source_code_changes"

Agilizer::Data::IssueRepository.identifiers.each do |identifier|
  logger.info "Processing issue #{identifier}"
  Agilizer::Enrichments::SourceCodeChanges.run(identifier)
end
